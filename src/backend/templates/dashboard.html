<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SGA</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f9f9f9; color: #333; }
        .navbar { background-color: #333; padding: 10px 20px; color: white; display: flex; justify-content: space-between; align-items: center; }
        .navbar a { color: white; text-decoration: none; padding: 8px 15px; }
        .navbar a:hover { background-color: #555; border-radius: 4px; }
        .navbar .user-info { font-weight: bold; }
        .navbar .logout-form button { background-color: #d9534f; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        .navbar .logout-form button:hover { background-color: #c9302c; }
        .container { padding: 20px; }
        h1 { color: #333; }
        .message { text-align: center; margin-top: 15px; padding: 10px; border-radius: 4px; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="brand"><a href="/">SGA v2.0</a></div>
        <div class="user-info">
            {% if user and user.is_authenticated %}
                <span>Bienvenido, {{ user.nombre_completo }} ({{ user.rol.value }})</span>
            {% else %}
                <span>Invitado</span>
            {% endif %}
        </div>
        <div>
            {% if user and user.is_authenticated %}
                <form id="logoutForm" style="display: inline;">
                     <button type="submit">Cerrar Sesión</button>
                </form>
            {% else %}
                <a href="{{ url_for('views_bp.login_page') }}">Iniciar Sesión</a>
                <a href="{{ url_for('views_bp.register_page') }}">Registrarse</a>
            {% endif %}
        </div>
    </nav>

    <div class="container">
        <h1>Dashboard Principal</h1>
        <p>Este es el panel principal del Sistema de Gestión de Activos.</p>
        <p>Aquí podrás ver un resumen de tus activos, tareas pendientes, etc.</p>

        <!-- Contenido específico del dashboard irá aquí -->

        <div id="messageArea" class="message" style="display:none;"></div>

        <h3>Enlaces Rápidos (Ejemplos):</h3>
        <ul>
            <li><a href="/admin/">Ir al Panel de Administración Original (QR)</a></li>
            <!-- Más enlaces a módulos del SGA irán aquí -->
            <li><a href="#">Gestionar Activos (Próximamente)</a></li>
            <li><a href="#">Registrar Compra (Próximamente)</a></li>
        </ul>
    </div>

    <script>
        const logoutForm = document.getElementById('logoutForm');
        if (logoutForm) {
            logoutForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const messageArea = document.getElementById('messageArea');
                messageArea.style.display = 'none';
                messageArea.className = 'message';

                try {
                    const response = await fetch('/api/auth/logout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const data = await response.json();
                    if (response.ok) {
                        window.location.href = '/auth/login';
                    } else {
                        messageArea.textContent = data.message || 'Error al cerrar sesión.';
                        messageArea.classList.add('error');
                        messageArea.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error en la petición de logout:', error);
                    messageArea.textContent = 'Ocurrió un error al intentar cerrar sesión.';
                    messageArea.classList.add('error');
                    messageArea.style.display = 'block';
                }
            });
        }
    </script>
</body>
</html>
